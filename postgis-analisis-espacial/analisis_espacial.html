<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Análisis espacial &mdash; Curso de PostGIS 2.0 - PATHII, Tegucigalpa 2013 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Curso de PostGIS 2.0 - PATHII, Tegucigalpa 2013 1.0 documentation" href="../index.html" />
    <link rel="prev" title="Validación" href="../postgis-validacion/validacion.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../postgis-validacion/validacion.html" title="Validación"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Curso de PostGIS 2.0 - PATHII, Tegucigalpa 2013 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="admonition note">
<p class="first admonition-title">Note</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1 Noviembre 2012</td>
<td><ul class="first last simple">
<li>Micho García (<a class="reference external" href="mailto:micho&#46;garcia&#37;&#52;&#48;geomati&#46;co">micho<span>&#46;</span>garcia<span>&#64;</span>geomati<span>&#46;</span>co</a>)</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>15 Octubre  2013</td>
<td><ul class="first last simple">
<li>Jorge Arévalo(<a class="reference external" href="mailto:jorge&#46;arevalo&#37;&#52;&#48;geomati&#46;co">jorge<span>&#46;</span>arevalo<span>&#64;</span>geomati<span>&#46;</span>co</a>)</li>
</ul>
</td>
</tr>
<tr class="row-even"><td>1 Diciembre 2013</td>
<td><ul class="first last simple">
<li>Micho García (<a class="reference external" href="mailto:micho&#46;garcia&#37;&#52;&#48;geomati&#46;co">micho<span>&#46;</span>garcia<span>&#64;</span>geomati<span>&#46;</span>co</a>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2012 Micho García</p>
<p class="last">Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia : Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
</div>
<div class="section" id="analisis-espacial">
<h1>Análisis espacial<a class="headerlink" href="#analisis-espacial" title="Permalink to this headline">¶</a></h1>
<p>El análisis de datos con SIG tiene por finalidad descubrir estructuras espaciales, asociaciones y relaciones entre los datos, así como modelar fenómenos geográficos. Los resultados reflejan la naturaleza y calidad de los datos, además de la pertinencia de los métodos y funciones aplicadas. Las tareas y transformaciones que se llevan a cabo en el análisis espacial precisan datos estructurados, programas con las funciones apropiadas y conocimientos sobre la naturaleza del problema, para definir los métodos de análisis.</p>
<p>El proceso convierte los datos en información útil para conocer un problema determinado. Es evidente que los resultados del análisis espacial añaden valor económico y, sobre todo, información y conocimiento a los datos geográficos</p>
<div class="section" id="operadores-espaciales">
<h2>Operadores espaciales<a class="headerlink" href="#operadores-espaciales" title="Permalink to this headline">¶</a></h2>
<p>Estos son los encargados de realizar operaciones geométricas entre las geometrías que se les pasa como argumentos. Están definidos en la norma SFA y PostGIS soporta todos ellos.</p>
<div class="section" id="buffer">
<h3>Buffer<a class="headerlink" href="#buffer" title="Permalink to this headline">¶</a></h3>
<p>Es el conjunto de puntos situados a una determinada distancia de la geometría</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/st_buffer.png"><img alt="../_images/st_buffer.png" src="../_images/st_buffer.png" style="width: 250.0px; height: 187.5px;" /></a>
</div></blockquote>
<p>Acepta distancias negativas, pero estas en lineas y puntos devolverán el conjunto vacio.</p>
</div>
<div class="section" id="interseccion">
<h3>Intersección<a class="headerlink" href="#interseccion" title="Permalink to this headline">¶</a></h3>
<p>Genera una geometría a partir de la intersección de las geometrías que se les pasa como parámetros.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/intersection.jpg"><img alt="../_images/intersection.jpg" src="../_images/intersection.jpg" style="width: 371.5px; height: 150.5px;" /></a>
</div></blockquote>
<p>¿Cúal es el area en común de dos círculos situados en los puntos (0 0) y (3 0) de radio 2?:</p>
<div class="highlight-python"><pre>SELECT ST_AsText(ST_Intersection(
  ST_Buffer('POINT(0 0)', 2),
  ST_Buffer('POINT(3 0)', 2)
));</pre>
</div>
<div class="section" id="practica">
<h4>Práctica<a class="headerlink" href="#practica" title="Permalink to this headline">¶</a></h4>
<p>Trabajaremos con la capa honduras_carreteras y edificaciones. Comprobaremos en el estado de Olancho, cuantas casas se encuentran afectadas por el ruido de este tipo de vias. Para determinar si una vivienda se ve afectada por el ruido, tomaremos como valor 500m el mínimo recomendado para vivir alejado de este tipo de vías.</p>
<p>Primero crearemos una capa con las vias de este tipo que se encuentren en Choluteca:</p>
<div class="highlight-python"><pre># SELECT * INTO gis.vias1_choluteca
FROM (
        SELECT ca.gid, ca.tipo, ca.geom FROM gis.honduras_carreteras as ca,
        gis.honduras_departamentos as de
        WHERE ST_Intersects(ca.geom, de.geom)
        AND de.name_1 like 'Choluteca'
        AND ca.tipo like 'Primary Route'
) as foo</pre>
</div>
<p>Ahora calcularemos el buffer de 500m para las vías y lo guardaremos en otra tabla:</p>
<div class="highlight-python"><pre># SELECT * INTO gis.buffer_vias1_choluteca
FROM (
        SELECT ca.gid, ca.tipo, ST_Buffer(ca.geom, 500, 'endcap=round join=round')::geometry('POLYGON', 32616) as geom FROM gis.vias1_choluteca as ca
) as buf</pre>
</div>
<p>Y podremos obtener las edificaciones tipo casa que se encuentren a menos de 500m de la via:</p>
<div class="highlight-python"><pre># SELECT * INTO gis.casas_afectadas
FROM (
        SELECT casas_cho.gid, casas_cho.geom
        FROM  (
                SELECT ed.gid,ed.geom
                FROM gis.edificaciones as ed, gis.honduras_departamentos as dep
                WHERE ST_Intersects(dep.geom, ed.geom)
                AND ed.tipo = 1
                AND dep.name_1 like 'Choluteca'
        ) as casas_cho, gis.buffer_vias1_choluteca as buf
        WHERE ST_Intersects(buf.geom, casas_cho.geom)
) as foobar</pre>
</div>
</div>
</div>
<div class="section" id="union">
<h3>Unión<a class="headerlink" href="#union" title="Permalink to this headline">¶</a></h3>
<p>Al contrario que en el caso anterior, la unión produce una geometría común con las geometrías que se le pasa a la función como argumento. Esta función acepta como parámetro dos opciones, las geometrías que serán unidas:</p>
<div class="highlight-python"><pre>ST_Union(Geometría A, Geometría B)</pre>
</div>
<p>o una colección de geometrías:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ST_Union</span><span class="p">([</span><span class="n">Geometry</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/union.jpg"><img alt="../_images/union.jpg" src="../_images/union.jpg" style="width: 461.0px; height: 133.5px;" /></a>
<div class="section" id="id1">
<h4>Práctica<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Tratar de simplificar todos los municipios de Olancho en un único polígono y comprobar si generan una geometría identica a la de su departamento.</p>
<p>Para esto se podría usar la versión agregada <strong>ST_Union</strong>, que toma como entrada un conjunto de geometrías y devuelve la unión de las mismas también como geometría.</p>
<p>La consulta SQL es ésta:</p>
<div class="highlight-python"><pre># SELECT * INTO gis.municipios_olancho
FROM (
        SELECT mun.depart as nombre, ST_Union(mun.geom) as geom FROM gis.honduras_municipios as mun,
        gis.honduras_departamentos as dep
        WHERE mun.depart like 'Olancho' group by mun.depart
) as foo</pre>
</div>
<p>Para comprobar si son iguales:</p>
<div class="highlight-python"><pre># SELECT ST_Equals(mun.geom, dep.geom)
FROM gis.honduras_departamentos as dep, gis.municipios_olancho as mun
WHERE dep.name_1 like 'Olancho';</pre>
</div>
</div>
</div>
<div class="section" id="diferencia">
<h3>Diferencia<a class="headerlink" href="#diferencia" title="Permalink to this headline">¶</a></h3>
<p>La diferencía entre dos geometrías A y B, son los puntos que pertenecen a A, pero no pertenecen a B</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/STDifference.png"><img alt="../_images/STDifference.png" src="../_images/STDifference.png" style="width: 320.0px; height: 168.5px;" /></a>
</div></blockquote>
<div class="highlight-python"><pre>ST_Difference(Geometría A, Geometría B)</pre>
</div>
</div>
<div class="section" id="diferencia-simetrica">
<h3>Diferencia simétrica<a class="headerlink" href="#diferencia-simetrica" title="Permalink to this headline">¶</a></h3>
<p>Es el conjunto de puntos que pertenecen a A o a B pero no a ambas.</p>
<blockquote>
<div><img alt="../_images/symdifference.gif" src="../_images/symdifference.gif" />
</div></blockquote>
<div class="highlight-python"><pre>ST_SymDifference(Geometría A, Geometría B)</pre>
</div>
</div>
<div class="section" id="tipos-de-geometrias-devueltas">
<h3>Tipos de geometrías devueltas<a class="headerlink" href="#tipos-de-geometrias-devueltas" title="Permalink to this headline">¶</a></h3>
<p>El tipo de geometrías que devuelven estas operaciones no tienen porque ser igual al tipo de geometrías que le son pasadas como argumentos. Estas operaciones devolverán:</p>
<blockquote>
<div><ul class="simple">
<li>Una única geometría</li>
<li>Una geometría <em>Multi</em> si está compuesta por varias geometrías del mismo tipo</li>
<li>Una <em>GeometryCollection</em> si está formada por geometrías de distinto tipo.</li>
</ul>
</div></blockquote>
<p>En este último caso habrá que proceder a una homogeneización de las geometrías que son devueltas, para ello podremos utilizar diferentes estrategias:</p>
<blockquote>
<div><ul class="simple">
<li>El uso de clausulas de filtrado, por ejemplo indicando que solo se devuelvan aquellas geometrías cuya intersección sea una línea.</li>
<li>Crear las tablas de salida de tipo <em>Multi</em>, en este caso las geometrías que no sean multi podrán ser convertidas a este tipo mediante la función <tt class="docutils literal"><span class="pre">ST_Multi</span></tt></li>
<li>En caso de que las geometrías devueltas sean tipo <em>GeometryCollection</em>, será necesario iterar esta colección, y extraer mediante la función <tt class="docutils literal"><span class="pre">ST_CollectionExtract</span></tt> las geometrías en las que estamos interesados, indicandole para ello a la función la dimensión de las geometrías.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="transformacion-y-edicion-de-coordenadas">
<h2>Transformación y edición de coordenadas<a class="headerlink" href="#transformacion-y-edicion-de-coordenadas" title="Permalink to this headline">¶</a></h2>
<p>Mediante el uso de diferentes funciones seremos capaces de manejar transformaciones entre sistemas de coordenadas o hacer reproyeciones de las capas. Para un manejo básico de estas utilizaremos las funciones que PostGIS pone a nuestra disposición:</p>
<blockquote>
<div><ul class="simple">
<li><strong>ST_Transform(geometría, srid)</strong>, que nos permite la transformación de la geometría al SRID que le pasamos por parámetro.</li>
<li><strong>ST_SRID(geometria)</strong> nos muestra el SRID de la geometría</li>
<li><strong>ST_SetSRID(geometria, srid)</strong> asigna el SRID a la geometría pero sin relizar la transformación</li>
</ul>
</div></blockquote>
<p>En la tabla <tt class="docutils literal"><span class="pre">spatial_ref_sys</span></tt> encontraremos la definición de los sistemas de coordenadas de los que disponemos. Podremos consultar la descripción de ellos mediante consultas <tt class="docutils literal"><span class="pre">select</span></tt> del estilo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># select * from spatial_ref_sys where srid=4326;</span>
</pre></div>
</div>
<p>Para transformar las geometrías en otros sistemas de coordenadas, lo primero que debemos saber es el sistema de coordenadas de origen y el de destino. Hemos de consultar que estos se encuentran en la tabla <tt class="docutils literal"><span class="pre">spatial_ref_sys</span></tt>. En caso de que alguna de nuestras tablas no tenga asignado un SRID, el valor de este será 0, valor por defecto, por lo que habrá que asignarle el sistema de coordenadas antes de la transformación.</p>
<div class="section" id="cambio-del-srs-de-una-tabla">
<h3>Cambio del SRS de una tabla<a class="headerlink" href="#cambio-del-srs-de-una-tabla" title="Permalink to this headline">¶</a></h3>
<p>Tras la importación de una capa mediante shp2pgsql nos damos cuenta de que en el momento de la carga no se eligió el SRS de la misma por lo que ahora nos aparece con el SRS por defecto 0 (versiones de PostGIS &gt;= 2.0). Para no realizar la importación de nuevo vamos a ver como se puede cambiar el SRS de la capa.</p>
<blockquote>
<div><p># UPDATE gis.farmacias SET geom = ST_SetSRID(geom, 32616);</p>
<p>ERROR:  Geometry SRID (32616) does not match column SRID (4326)</p>
<p><strong>******</strong> Error <strong>******</strong></p>
<p>ERROR: Geometry SRID (32616) does not match column SRID (4326)
SQL state: 22023</p>
</div></blockquote>
<p>Esto nos indica que no es posible almacenar en la tabla datos con el SRS 32616 ya que solo permite SRS 4326.</p>
<p>Podremos modificar el tipo de dato si tiene restricciones que comprueben el SRS mediante la eliminación de la restricción y la recreación de la misma con el nuevo SRS. PostGIS nos ofrece la función <tt class="docutils literal"><span class="pre">updateGeometrySRID</span></tt> que realizaría de manera automática las operaciones anteriores:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># SELECT ST_AsEWKT(way) FROM gis.farmacias;</span>

<span class="s">&quot;SRID=4326;POINT(-87.2238485 14.0978939)&quot;</span>

<span class="c"># SELECT updateGeometrySRID(&#39;gis&#39;,&#39;farmacias&#39;, &#39;way&#39;, 32616);</span>

<span class="c"># SELECT ST_AsEWKT(way) FROM gis.farmacias;</span>

<span class="s">&quot;SRID=32616;POINT(-87.2238485 14.0978939)&quot;</span>
</pre></div>
</div>
<p>Podremos comprobar facilmente que se ha realizado el cambio del sistema de coordenadas, pero también veremos que el valor de las mismas no ha cambiado.</p>
</div>
<div class="section" id="reproyeccion-de-la-capa">
<h3>Reproyección de la capa<a class="headerlink" href="#reproyeccion-de-la-capa" title="Permalink to this headline">¶</a></h3>
<p>Para realizar la reproyección de una capa disponemos de la función <tt class="docutils literal"><span class="pre">ST_Transform</span></tt>. Si queremos reproyectar una capa podremos hacerlo facilmente transformando las coordenadas y creando con ellas una nueva tabla:</p>
<div class="highlight-python"><pre># SELECT * INTO gis.farmacias_reproyectadas
FROM (
        SELECT osm_id,ST_Transform(way, 32616)  FROM gis.farmacias
) as foo</pre>
</div>
<p>Si lo que queremos es reproyectar la misma capa:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ALTER TABLE gis.farmacias ALTER COLUMN way TYPE geometry;</span>
<span class="c"># UPDATE gis.farmacias SET way = ST_Transform(way, 32616);</span>
<span class="c"># ALTER TABLE gis.farmacias ALTER COLUMN way TYPE geometry(&#39;POINT&#39;, 32616);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="simplificacioon-de-geometrias">
<h2>Simplificacióon de geometrías<a class="headerlink" href="#simplificacioon-de-geometrias" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">ST_RemoveRepeatedPoints(geom)</span></tt>, elimina los puntos repetidos de los vértices. En el modelo usado por PostGIS se permiten vertices con puntos repetidos.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># SELECT ST_AsText(ST_RemoveRepeatedPoints(&#39;LINESTRING(0 0, 1 0, 1 0, 3 0, 3 0, 6 0, 8 0)&#39;);</span>

<span class="s">&quot;LINESTRING(0 0, 1 0, 3 0, 6 0, 8 0)&quot;</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">ST_SnapToGrid(geom)</span></tt>, realiza un redondeo de las coordenadas de los vértices de una geometría. Además el uso de esta función elimina los vértices que se encuentran en una misma celda. Para realizar el proceso se utiliza una rejilla que se pasa a la función como parte de los parámetros.</p>
<blockquote>
<div><p># SELECT st_isvalid(geom) FROM gis.honduras;</p>
<p># SELECT * INTO gis.honduras_snap
FROM (select st_snaptogrid(geom, 100)::geometry(&#8216;MULTIPOLYGON&#8217;, 32616) as geom from gis.honduras) as foo</p>
<p># SELECT sum(st_npoints(geom)) FROM gis.honduras_snap</p>
<p># SELECT st_isvalid(geom) FROM gis.honduras_snap;</p>
</div></blockquote>
<p>Otras herramientas de simplificación de geometrías son <tt class="docutils literal"><span class="pre">ST_Simplify</span></tt> y <tt class="docutils literal"><span class="pre">ST_SimplifyPreserveTopology</span></tt></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Análisis espacial</a><ul>
<li><a class="reference internal" href="#operadores-espaciales">Operadores espaciales</a><ul>
<li><a class="reference internal" href="#buffer">Buffer</a></li>
<li><a class="reference internal" href="#interseccion">Intersección</a><ul>
<li><a class="reference internal" href="#practica">Práctica</a></li>
</ul>
</li>
<li><a class="reference internal" href="#union">Unión</a><ul>
<li><a class="reference internal" href="#id1">Práctica</a></li>
</ul>
</li>
<li><a class="reference internal" href="#diferencia">Diferencia</a></li>
<li><a class="reference internal" href="#diferencia-simetrica">Diferencia simétrica</a></li>
<li><a class="reference internal" href="#tipos-de-geometrias-devueltas">Tipos de geometrías devueltas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transformacion-y-edicion-de-coordenadas">Transformación y edición de coordenadas</a><ul>
<li><a class="reference internal" href="#cambio-del-srs-de-una-tabla">Cambio del SRS de una tabla</a></li>
<li><a class="reference internal" href="#reproyeccion-de-la-capa">Reproyección de la capa</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simplificacioon-de-geometrias">Simplificacióon de geometrías</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../postgis-validacion/validacion.html"
                        title="previous chapter">Validación</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/postgis-analisis-espacial/analisis_espacial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../postgis-validacion/validacion.html" title="Validación"
             >previous</a> |</li>
        <li><a href="../index.html">Curso de PostGIS 2.0 - PATHII, Tegucigalpa 2013 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Micho García.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>