<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Tema 4 - PostGIS</title>

		<meta name="description" content="Curso de Bases de Datos Espaciales con PostGIS 2.0">
		<meta name="author" content="geomati.co">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="../css/reveal.min.css">
		<link rel="stylesheet" href="../css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="../lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="../css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="../lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element between this containers is displayed as a slide -->
			<div class="slides">
    <section>
        <h1>PostGIS</h1>
        <div>
            <br>
        </div>
        <div>
            <img src="img/abb1.jpg" style="width: 283.448642408672px; height: 409.2998584169984px; max-height: none; max-width: none;">
            <br>
        </div>
    </section>
    <section>
        <h2>Objetivos</h2>
        <div>
            <br>
        </div>
        <div>
            <div>
                <br>
            </div>
            <div>Instalar PostGIS</div>
            <div>Comprender la creación de nuevos objetos geométricos</div>
            <div>Inspeccionar las nuevas funciones geométricas y las nuevas tablas geométricas</div>
            <div>Conocer las tablas de metadatos spatial_ref_sys y las vistas &nbsp;geometry colums y geography_columns</div>
        </div>
    </section>
    <section>
        <h2>¿qué es postgis?</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>PostGIS añade soporte espacial a la base de datos relacional PostgreSQL.&nbsp;</div>
        <div>Le da a PostgreSQL la capacidad de almacenar, consultar y manipular datos espaciales<br>
        </div>
        <div>
            <br>
        </div>
        <div>Licenciado con GNU GPL<br>
        </div>
    </section>
    <section>
        <h2 style="font-style: normal; font-variant: normal;">¿QUÉ ES POSTGIS?</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <div>Desarrollado en lenguaje C</div>
            <div>Utiliza la librería GEOS (wrapper JTS)</div>
            <div>Implementa OGC Simple Feature Access</div>
        </div>
    </section>
    <section>
        <h2>Instalación</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <div>Desde repositorios:</div>
            <div>
                <br>
            </div>
            <div>
                <i>$ sudo apt-get install postgis postgresql-X.X-postgis</i>
            </div>
        </div>
    </section>
    <section>
        <h2>Espacialización de la base de datos</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>Crear una base de datos espacial y definir como plantilla para la creación de bases de datos posteriores<br>
        </div>
    </section>
    <section>
        <h2>Espacialización de la base de datos</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>Directorio con archivos para la creación:<br>
        </div>
        <div>
            <br>
        </div>
        <div>cd /usr/share/postgresql/9.1/contrib/postgis-2.0/<br>
        </div>
    </section>
    <section>
        <h2>Espacialización de la base de datos</h2>
        <div>
            <br>
        </div>
        <div>Creación de la base de datos template_postgis<br>
        </div>
        <div>
            <br>
        </div>
        <div>Ejecutamos los scripts con el usuario postgres contra la base de datos template_postgis<br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <div>
                <i>$ psql -U postgres -d template_postgis -f postgis.sql</i>
            </div>
            <div>
                <i>$ psql -U postgres -d template_postgis -f spatial_ref_sys.sql</i>
            </div>
        </div>
    </section>
    <section>
        <h2>Espacialización de la base de datos</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div class="absolute-element" style="position: absolute; width: 952px; height: 544px; z-index: 4; left: 1px; top: 131px;">
            <img src="img/espacializacion.png">
            <br>
        </div>
    </section>
    <section>
        <h2 style="font-style: normal; font-variant: normal;">ESPACIALIZACIÓN DE LA BASE DE DATOS</h2>
        <div>
            <br>
        </div>
        <div class="absolute-element" style="position: absolute; width: 968px; height: 553px; z-index: 4; left: -5px; top: 121px;">
            <img src="img/espacializacion-2.png">
            <br>
        </div>
    </section>
    <section>
        <h2 style="font-style: normal; font-variant: normal;">ESPACIALIZACIÓN DE LA BASE DE DATOS</h2>
        <div>
            <br>
        </div>
        <div class="absolute-element" style="position: absolute; width: 968px; height: 553px; z-index: 4; left: -5px; top: 123px;">
            <img src="img/espacializacion-3.png">
            <br>
        </div>
    </section>
    <section>
        <h2 style="font-style: normal; font-variant: normal;">ESPACIALIZACIÓN DE LA BASE DE DATOS</h2>
        <div>
            <br>
        </div>
        <div class="absolute-element" style="position: absolute; width: 968px; height: 553px; z-index: 4; left: -12px; top: 125px;">
            <img src="img/espacializacion-4.png">
            <br>
        </div>
    </section>
    <section>
        <h2 style="font-style: normal; font-variant: normal;">ESPACIALIZACIÓN DE LA BASE DE DATOS</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <div>Tabla spatial_ref_sys:</div>
            <div>
                <br>
            </div>
            <div>contiene una lista con los sistemas de referencia disponibles</div>
        </div>
    </section>
    <section>
        <h2>Espacialización de la base de datos</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <div>Vista geometry_columns:</div>
            <div>
                <br>
            </div>
            <div>catálogo de las columnas espaciales existentes en la base de datos. PostGIS debe buscarse una manera de identificar qué campo contiene geometrías. Esto se hace de manera estándar (OGC) manteniendo un catálogo con la lista de columnas espaciales que existen. Hay que tenerla siempre actualizada</div>
        </div>
        <div>
            <br>
        </div>
    </section>
    <section>
        <h2>Espacialización de la base de datos</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <i># SELECT postgis_full_version();</i>
            <br>
        </div>
    </section>
    <section>
        <h2>Creación de la plantilla</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>Podremos utilizar la base de datos creada inicialmente como plantilla para la posterior creación de bases de datos espaciales evitando tener que repetir el proceso<br>
        </div>
    </section>
    <section>
        <h2 style="font-style: normal; font-variant: normal;">CREACIÓN DE LA PLANTILLA</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <div>
                <i># UPDATE pg_database&nbsp;</i>
            </div>
            <div>
                <i>SET datistemplate = TRUE&nbsp;</i>
            </div>
            <div>
                <i>WHERE datname = 'template_postgis';</i>
            </div>
        </div>
    </section>
    <section>
        <h2>Creación de la plantilla</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <div>
                <i># GRANT ALL ON geometry_columns TO PUBLIC;</i>
            </div>
            <div>
                <i># GRANT ALL ON geography_columns TO PUBLIC;</i>
            </div>
            <div>
                <i># GRANT ALL ON spatial_ref_sys TO PUBLIC;</i>
            </div>
        </div>
    </section>
    <section>
        <h2>Creación de la base de datos espacial</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <i>&nbsp;# CREATE DATABASE curso TEMPLATE=template_postgis</i>
            <br>
        </div>
    </section>
    <section>
        <h2>Creación de tablas espaciales</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>Creamos la tabla, bien con create table o desde pgAdmin<br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
    </section>
    <section>
        <h2>Creación de tablas espaciales</h2>
        <div>
            <div>Definimos campo geométrico:</div>
            <div>
                <br>
            </div>
            <div>Usando geometry (typmod):</div>
            <div style="text-align: left; ">
                <i># alter table [nombre_tabla] add column geom geometry([tipo_geometria], SRID)</i>
            </div>
            <div>
                <br>
            </div>
            <div>
                <br>
            </div>
            <div>O usando el estandar:</div>
            <div style="text-align: left; ">
                <i># SELECT AddGeometryColumn ('mi_schema','mi_tabla','geom',SRID,'[tipogeometria]',dimension);</i>
            </div>
        </div>
    </section>
    <section>
        <h2>Caracteristicas espaciales postgis</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <span>Funciones espaciales</span>
            <br>
        </div>
        <div>
            <span style="font-size: 36.47214889526367px; font-style: normal; font-variant: normal;">Indices espaciales</span>
            <span>
                <br>
            </span>
        </div>
    </section>
    <section>
        <h2>Funciones espaciales</h2>
        <div>
            <br>
        </div>
        <div>
            <br>
        </div>
        <div>
            <div>Una base de datos ordinaria proporciona funciones para manipular los datos en una consulta como concatenación de cadenas, operaciones matemáticas o la extracción de información de las fechas. Una base de datos espacial proporciona un completo juego de funciones para poder realizar análisis con los objetos espaciales: analizar la composición del objeto, determinar su relación espacial con otros objetos, transformarlo, etc.</div>
        </div>
        <div>
            <br>
        </div>
    </section>
    <section>
        <h2>funciones espaciales</h2>
        <div>
            <div>La mayor parte de las funciones espaciales pueden ser agrupadas en una de las siguientes cinco categorías:</div>
            <div>
                <br>
            </div>
            <div style="text-align: left; ">
                <b>Conversión</b>: Funciones que convierten las geometrías a otros formatos externos</div>
                <div style="text-align: left; ">
                    <b>Gestión</b>: Tareas administrativas de PostGIS</div>
                    <div style="text-align: left; ">
                        <b>Recuperación</b>: Obtienen propiedades y medidas de las geometrías.</div>
                        <div style="text-align: left; ">
                            <b>Comparación</b>: Comparan dos geometrías y obtienen información sobre su relación espacial.</div>
                            <div style="text-align: left; ">
                                <b>Generación</b>: Generan geometrías a partir de otros tipos de datos.</div>
                            </div>
                            <div>
                                <br>
                            </div>
                        </section>
                        <section>
                            <h2>Índices espaciales</h2>
                            <div>
                                <br>
                            </div>
                            <div class="absolute-element" style="position: absolute; width: 952px; height: 557px; z-index: 4; left: 8px; top: 108px;">
                                <div style="text-align: left; ">
                                    <font style="font-size: 24px;">La indexación para tipos de datos estándar que pueden ser ordenados (alfabéticamente o numéricamente) consiste en esencia en ordenar estos registros de manera que sea fácil localizarlos.</font>
                                </div>
                                <div style="text-align: left; ">
                                    <font style="font-size: 24px;">
                                        <br>
                                    </font>
                                </div>
                                <div style="text-align: left; ">
                                    <font style="font-size: 24px;">Pero en el caso de la información espacial no existe un orden total ya que un polígono puede contener a un punto, cruzarse con una línea, etc. Se ponen en marcha ciertas estrategias para asociar los registros con determinadas partes del territorio que cubren y así poder obtener los registros que se encuentran cerca de una posición dada.</font>
                                </div>
                                <div style="text-align: left; ">
                                    <font style="font-size: 24px;">
                                        <br>
                                    </font>
                                </div>
                                <div style="text-align: left; ">
                                    <font style="font-size: 24px;">PostgreSQL implementa un algoritmo de indexación espacial denomimado GiST (Generalized Search Tree). PostGIS extiende los índices GiST para que funcionen adecuadamente con los tipos geometry.</font>
                                </div>
                            </div>
                        </section>
                    </div>


			<!-- Any section element between this container is displayed as a slide -->
		</div>

		<script src="../lib/js/head.min.js"></script>
		<script src="../js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: '../lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: '../plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '../plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: '../plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>			
